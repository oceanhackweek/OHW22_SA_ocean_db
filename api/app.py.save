from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from fastapi.responses import JSONResponse
import pandas as pd
import json

app = FastAPI()

#this is use to allow to access the api from a webapp
app.add_middleware(
	CORSMiddleware,
	allow_origins=["*"], # Allows all origins
	allow_credentials=True,
	allow_methods=["*"], # Allows all methods
	allow_headers=["*"], # Allows all headers
	)

@app.get("/")
def index():
	return {"greeting": "Hello world"}

@app.get("/bouyid/{id}")
def index(bouyid, where=None, var=None):
	SELECT wvdir,datetime FROM ohw_satlantic.pnboia_buoy WHERE pnboia_id=27 AND datetime >= '2022-01-01' AND datetime <= '2022-08-15'
	df = pd.read_csv('api/abrolhos.csv')
	v = json.dumps(json.loads(df.to_json(orient="records")))
	return {v}
